{% extends "base.html" %}

{% block content %}
  <html>
    <head>
      <title>Mapping my runs</title>
    </head>

    <body>
      <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
      <script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
      <div id="map" style="width: 100%; height: 100%"></div>
      <script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>
      <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

      <script>
      var map = L.map('map').setView([44.2706, -71.3033], 13);
      L.tileLayer(
          'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 18,
          }).addTo(map);

      var encodedRoutes = {{ all_polylines|safe }}
      var markers = {{ map_markers|safe }}

      console.log('markers')
      //console.log(markers)

      for (let encoded of encodedRoutes) {
        var coordinates = L.Polyline.fromEncoded(encoded).getLatLngs();
        L.polyline(

            coordinates,
            {
                color: 'blue',
                weight: 2,
                opacity: .7,
                lineJoin: 'round'
            }
        ).addTo(map);
      }

      for (let m of markers) {

        if (m['act_names'] != 'missing') {
          var mydiv = document.createElement("myDiv");
          var aTag = document.createElement('a');
          aTag.innerText = m['name'] + "\n";
          mydiv.appendChild(aTag);

          var i = 0;
          for (var name of m['act_names']) {
          var aTag = document.createElement('a');
          urls = m['urls'];
          aTag.setAttribute('href', urls[i]);
          aTag.setAttribute('target', "_blank");
          aTag.innerText = name + "\n";
          mydiv.appendChild(aTag);
          i++;
          }


        L.marker([m['lat'], m['lon']]).addTo(map).bindPopup(mydiv);
        }
      else {
          console.log('test')
          console.log(m)

        var redMarker = L.AwesomeMarkers.icon({
          markerColor: 'red'
          });

      L.marker([m['lat'], m['lon']], {icon: redMarker}).addTo(map).bindPopup(m['name']);
      }
  }


      



      </script>
    </body>
  </html>
{% endblock %}
